<!--
coding: utf-8
Copyright (C) 2016 Sumitrag (www.sumitrag.com)
Developer: David ProaÃ±o <davisxdpfr@gmail.com>
-->

<!-- search-bar element, this element has the code to make a search in a dataSet-->

<link rel="import" href="app/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="app/bower_components/paper-input/paper-input.html">
<link rel="import" href="app/bower_components/paper-item/paper-item.html">
<link rel="import" href="app/bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="app/bower_components/polymer/polymer.html">
<link rel="import" href="app/bower_components/iron-flex-layout/iron-flex-layout.html">

<script src="app/bower_components/jquery/dist/jquery.min.js"></script>
<script src="jss/operations.js"></script>

<dom-module id="search-bar">

    <style>
        .container {
            padding-left: 5%;
            @apply(--layout-horizontal);
        }

        .flexChild {
            @apply(--layout-flex);
        }

        .section {
            margin-bottom: 3%;
        }

        #buttonCancel {
            color: #F44336;
            margin-top: 2%;
        }

        #sectionSearch {
            height: var(--section-search-height);
        }

        iron-collapse {
            clear: both;
            width: 100%;
        }
    </style>
    <template>
        <iron-collapse id="collapse">
            <section class="container horizontal layout section" id="sectionSearch">
                <paper-input floatinglabel maxlength="254" id="field" value="{{value}}"
                             label="{{label}}" placeholder="[[placeholder]]" class="flexChild"></paper-input>
                <paper-icon-button icon="cancel" title="Cancel" id="buttonCancel" class="flexChild"
                                   on-click="restartSearchBar"></paper-icon-button>
            </section>
        </iron-collapse>
    </template>
    <script>
        (function() {
            Polymer({
                is: 'search-bar',
                properties: {
                    label: String,
                    placeholder: {
                        type: String,
                        value: 'Buscar'
                    },
                    value: {
                        type: String,
                        observer: 'changeValue'
                    },
                    searchSectionHeight: {
                        type: String,
                        value: '60px',
                        observer: 'changeSearchSectionHeight'
                    }
                },

                //Set the dataSet where is going to be done the search
                setSearchingDataSet: function(dataSet) {
                    var input = Polymer.dom(this.$.field.root).querySelector('input');
                    $(input).keyup(function() {
                        var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
                        $(dataSet).show().filter(function() {
                            var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
                            return !~text.indexOf(val);
                        }).hide();
                    });
                },

                //Button to close the search section and reload component
                restartSearchBar: function() {
                    this.$.field.value = '';
                    this.display = '';
                    this.toggle();
                },

                //Toggle the collapse
                toggle: function() {
                    this.searchSectionHeight = '60px';
                    this.$.collapse.toggle();
                },

                //Change CSS property height
                changeSearchSectionHeight: function(newValue) {
                    if (newValue) {
                        updateStyleDOM(this, '--section-search-height', newValue);
                    }
                },

                //Change the label and the placeholder according to the the value of the paper-input
                changeValue: function(newValue) {
                    if (newValue && newValue !== '') {
                        this.label = this.placeholder;
                    }
                    else if (newValue === '') {
                        this.label = '';
                    }
                }
            });
        })();
    </script>

</dom-module>
